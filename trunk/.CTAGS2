#!/usr/bin/env bash
#+
#:  \file       .CTAGS2
#:  \brief      \$Id$
#:  
#:  (C) 2004 - NHI - #1 - Project - Group
#:  
#:  \version    \$Rev$
#:  \author     EMail: aotto1968 at users.berlios.de
#:  \attention  this software has GPL permissions to copy
#:              please contact AUTHORS for additional information
#:

D=${PWD%%/NHI1*}/NHI1
DO="yes"
BASE=$(basename $PWD)

#. $D/env.sh

set -xu

if [[ $HOSTTYPE == "FreeBSD" ]] ; then
  ADD=""
else
  ADD="--c-kinds=+p"
fi

[[ ! -f $D/tags || $D/.CTAGS -nt $D/tags ]] && (
    cd $D
    ctags $(find /usr/include -type f)
    ctags -a $PWD/theLink/sqlite/sqlite3.c
)

cp $D/tags .

[[ $BASE != "libmsgque" && $BASE != "ccmsgque" ]] && {
  test -d $D/libmsgque && \
    ctags -a $ADD $D/libmsgque/*.[ch]
  test -d $D/theLink/libmsgque && \
    ctags -a $ADD $D/theLink/libmsgque/*.[ch]
}

[[ $PWD == *theBrain* ]] && \
  ctags -a $ADD $HOME/src/tokyocabinet-1.4.39-thread/*.[ch]

[[ $BASE = "c" ]] && {
    ctags -a $ADD *.[ch]
}

[[ $BASE = "cc" ]] && {
    ctags -a $ADD $abs_top_builddir/theLink/ccmsgque/*.h
}

[[ $BASE = "ccmsgque" ]] && {
    ctags -a $ADD --language-force=C++ $(find /usr/include/c++/4.3/ -type f)
    ctags -a $ADD *.cc *.h
}

[[ $BASE == "tclmsgque" ]] && {
    ctags -a $ADD $HOME/src/tcl-latest/generic/*.[ch]
    ctags -a $ADD $HOME/src/tcl-latest/unix/*.[ch]
    ctags -a $ADD *.[ch] -I HD,NS
    exit 0
}

[[ $BASE == "javamsgque" ]] && {
  find $JAVA_HOME/include -name "*.h" | \
    xargs ctags -a $ADD -I NS
  ctags -a $ADD *.java
}

[[ $BASE == "csmsgque" ]] && {
  ctags -a $ADD *.cs
}

[[ $BASE == "pymsgque" ]] && {
  find $HOME/ext/$MACHTYPE/test/include/python3* -name "*.h" | \
    xargs ctags -a $ADD -I PyAPI_DATA,PyAPI_FUNC
  find $HOME/src/python-latest -name "*.c" | \
    xargs ctags -a $ADD -I PyAPI_DATA,PyAPI_FUNC
  #ctags -a $ADD *.py
}

[[ $BASE == "msgqueforphp" || $BASE == "MsgqueForPhp" ]] && {
  find $HOME/src/php-latest -name "*.[ch]" | \
    xargs ctags -a $ADD
  find $HOME/ext/$MACHTYPE/test/include/php -name "*.[h]" | \
    xargs ctags -f php.tags $ADD -I PHP_METHOD
}

[[ $BASE == "rubymsgque" ]] && {
  find $HOME/src/ruby-latest -name "*.[ch]" | \
    xargs ctags -a $ADD
}

[[ $PWD == *example/java* ]] && {
  find $JAVA_HOME/include -name "*.h" | \
    xargs ctags -a $ADD -I NS
  ctags -a $ADD ../../javamsgque/*.java ../../javamsgque/*.[ch]
  ctags -a $ADD *.java
  DO=no
}

[[ $BASE == "perlmsgque" || $BASE == "Net-PerlMsgque" ]] && {
  if [[ ${WINDIR+set} == set ]] ; then
    PERL_HOME=/cygdrive/c/Perl/
    PERL_API=$PERL_HOME
  else
    PERL_HOME=$HOME/src/perl-latest/
    PERL_API=$HOME/ext/$MACHTYPE/test/lib/perl5
  fi
  
  find $PERL_API -name "*.h" | \
    xargs ctags -a $ADD 
  find $PERL_HOME -name "*.c" | \
    xargs ctags -a $ADD
  ctags -a $ADD -I XS --language-force=C *.[ch] *.xs
  DO="no"
}

[[ $BASE == "tests" ]] && {
  ctags -a $ADD ../../theLink/tests/*.tcl *.test
}

[[ $BASE == "libbrain" ]] && {
  ctags -a $ADD ../tokyocabinet/*.[ch]
}

[[ $BASE == "atrans" ]] && {
  ctags -a $ADD *.cc
}

# add all "c" and "h" files in the local directory
if [[ $DO == "yes" ]] ; then
  set *.[ch]
  test -f $1 && ctags -a $ADD -I NS "$@"
fi

## add

## add

exit 0

