#+
#§  \file       theGuard/tests/guard.test
#§  \brief      \$Id$
#§  
#§  (C) 2002 - NHI - #1 - Project - Group
#§  
#§  \version    \$Rev$
#§  \author     EMail: aotto1968 at users.berlios.de
#§  \attention  this software has GPL permissions to copy
#§              please contact AUTHORS for additional information
#§

set TS_SCRIPT [info script]
source [file join [file dirname [info script]] library.tcl]
if {![testConstraint guard]} return

##
## -----------------------------------------------------------------------
## init
##

#set tcl_traceExec 1

##
## -----------------------------------------------------------------------
## guard
##

# tests ----------------------------

test guard-1 {basic test, no error} \
    -body           {
      Exec {*}[getClient client] --num 1 @ aguard @ aguard @ server
    } \
    -returnCodes    ok \
    -match	    glob \
    -result         {NONE--C> (client:*) \[*] \[0-0-*-main]: start: --------------------------------------
C> (client:*) \[*] \[0-0-*-statistics]:             MqSendEND_AND_WAIT:*
C> (client:*) \[*] \[0-0-*-main]: end: ----------------------------------------}

test guard-2 {"one" guard error} \
    -body           {
      Exec {*}[getClient client] --num 1 @ aguard @ server
    } \
    -returnCodes    ok \
    -result         {CHILDSTATUS-1-C> (client) [service-call-error] <Tok|ECOU> <Num|1>
C> (aguard) [service-call-error] <Tok|+GRD> <Num|1>
S> (server) [pTokenInvoke] token <+GRD> not found
C> (client) use '-h' or '--help' for usage}

test guard-3 {"three" guard error} \
    -body           {
      Exec {*}[getClient client] --num 1 @ aguard @ aguard @ aguard @ server
    } \
    -returnCodes    ok \
    -result         {CHILDSTATUS-1-C> (client) [service-call-error] <Tok|ECOU> <Num|1>
C> (aguard) [service-call-error] <Tok|+GRD> <Num|1>
C> (aguard) [service-call-error] <Tok|ECOU> <Num|1>
C> (aguard) [service-call-error] <Tok|+GRD> <Num|1>
S> (server) [pTokenInvoke] token <+GRD> not found
C> (client) use '-h' or '--help' for usage}

##
## -----------------------------------------------------------------------
## finish
##

freeTests

